---
title: "ãƒªãƒã‚¸ãƒˆãƒªã®æœ€æ–°ã‚³ãƒŸãƒƒãƒˆãŒRenovateã ã‚‰ã‘ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹"
emoji: "ğŸ› ï¸"
type: "tech"
topics: ["renovate"]
published: true
---

ä½¿ã£ã¦ã¿ãŸã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®GitHubã‚’è¦‹ã«è¡Œã£ã¦ã‚³ãƒŸãƒƒãƒˆä¸€è¦§ãŒã“ã‚Œã ã£ãŸã‚‰ã¡ã‚‡ã£ã¨æ®‹å¿µã˜ã‚ƒãªã„ã§ã™ã‹ï¼Ÿ

![å¤§é‡ã®Renovateã®ã‚³ãƒŸãƒƒãƒˆ](/images/7e98a3a9ed8916/commits.png)

æœ€æ–°ã‚³ãƒŸãƒƒãƒˆãŒå…ˆé€±ã¨ã‹ã§ãŠã£çµæ§‹ãƒ¡ãƒ³ãƒ†ã•ã‚Œã¦ã‚‹ã˜ã‚ƒã‚“ã€ã¨æ€ã£ãŸã‚‰botã ã£ãŸæ™‚å°‘ã—ãŒã£ã‹ã‚Šã™ã‚‹...æ°—ãŒã™ã‚‹ã€‚

ä»–ã®äººã«ã‚‚ã“ã®æ°—æŒã¡ã‚’å‘³ã‚ã£ã¦ã»ã—ããªã„ã®ã§ã€å›é¿ç­–ã‚’è€ƒãˆã¾ã—ãŸã€‚

## å›é¿ç­–

renovate-pr(åå‰ã¯ãªã‚“ã§ã‚‚ã„ã„)ã¨ã„ã†Renovateå°‚ç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œã‚Šã¾ã™ã€‚

æµã‚Œã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

1. renovate-prãƒ–ãƒ©ãƒ³ãƒã«RenovateãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã‚’ãƒãƒ¼ã‚¸ã—ã¦ã„ã
2. é©å½“ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ‰‹å‹•ã§renovate-prã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’mainã«Squash and mergeã™ã‚‹
3. ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã«ã‚ˆã£ã¦GitHub ActionãŒå‹•ã„ã¦renovate-prãŒå†ä½œæˆã•ã‚Œã‚‹
4. 1.ã«æˆ»ã‚‹

ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚

![ãƒãƒ¼ã‚¸ã•ã‚Œã¦Renovate Updatesã¨ã„ã†1ã‚³ãƒŸãƒƒãƒˆã«ãªã£ã¦ã„ã‚‹](/images/7e98a3a9ed8916/merged.png)

## æ‰‹é †
### 1. renovate.jsonã®baseBranchesã‚’å¤‰æ›´

renovate.json ã®è¨­å®šã‚’å¤‰æ›´ã—ã€ãƒãƒ¼ã‚¸å…ˆã®ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒä»¥å¤–ã«è¨­å®šã™ã‚‹ã€‚

```json
{
  "baseBranches": ["renovate-pr"],
}
```

ã“ã‚Œã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã®PRãŒrenovate-prãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### 2. ã‚³ãƒŸãƒƒãƒˆæ™‚ã«ãƒ–ãƒ©ãƒ³ãƒã¨PRã‚’ä½œæˆã™ã‚‹GitHub Actionã‚’è¿½åŠ 

GitHubã®Automatically delete head branchesãŒæœ‰åŠ¹ã¨ã„ã†å‰æã§ã€mainãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹åº¦ã«renovate-prãƒ–ãƒ©ãƒ³ãƒãŒç„¡ã‘ã‚Œã°ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ä½œã‚‹ã¨ã„ã†GitHub Actionã‚’ä½œã£ã¦ãŠãã¾ã™ã€‚

```yml
name: commit

on:
  push:
    branches:
      - main

jobs:
  create-renovate-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - uses: actions/checkout@v4
      - name: Check PR
        id: check-pr
        run: echo "count=$(gh pr list -S 'Renovate Updates in:title' | wc -l)" >> "$GITHUB_OUTPUT"
      - name: Create PR
        if: steps.check-pr.outputs.count == 0
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git switch -c renovate-pr
          git commit --allow-empty -m "Renovate Updates"
          git push origin renovate-pr
          gh pr create -B main -H renovate-pr -t "Renovate Updates" -b ''
```

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

https://zenn.dev/kshida/articles/auto-generate-release-pr-with-github-actions

ã“ã®Actionã«ã‚ˆã£ã¦ã‚³ãƒŸãƒƒãƒˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§renovate-prã¨ã„ã†ãƒ–ãƒ©ãƒ³ãƒã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚

https://github.com/mkizka/unsocial/pull/369

## çµ‚ã‚ã‚Š

ãŠã‚ã‚Šã§ã™ã€‚
