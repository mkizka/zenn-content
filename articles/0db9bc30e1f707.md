---
title: "Remixã¯404ãƒšãƒ¼ã‚¸ã§æœ€å¤§3ã¤ã‚‚ãƒ­ã‚°ã‚’å‡ºã™"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react","typescript","remix"]
published: false
---

Remixã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸç›´å¾Œã«ã€é–‹ç™ºç’°å¢ƒã§404ã«ãªã‚‹ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```
Error: No route matches URL "/foo"
    at getInternalRouterError (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:4501:59)
    at Object.query (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:3331:19)
    at handleDocumentRequestRR (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:184:35)
    at requestHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:108:24)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async nodeHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:736:27)
    at async /home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:739:15
No routes matched location "/foo" 
ErrorResponseImpl {
  status: 404,
  statusText: 'Not Found',
  internal: true,
  data: 'Error: No route matches URL "/foo"',
  error: Error: No route matches URL "/foo"
      at getInternalRouterError (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:4501:59)
      at Object.query (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:3331:19)
      at handleDocumentRequestRR (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:184:35)
      at requestHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:108:24)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async nodeHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:736:27)
      at async /home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:739:15
}
```

:::message
ã“ã®è¨˜äº‹ã¯Remixã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³2.11.2ã§å‹•ä½œç¢ºèªã—ã¦ã„ã¾ã™ã€‚
:::


ã ã„ã¶é•·ã„ã‚¨ãƒ©ãƒ¼ã®ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ã“ã‚Œã‚‰ã¯åˆ¥ã€…ã®ã¨ã“ã‚ã‹ã‚‰ãã‚‹ãƒ­ã‚°å‡ºåŠ›ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã‚Œãã‚ŒãŒå‡ºåŠ›ã•ã‚Œã‚‹è¦å› ã«ã¤ã„ã¦èª¿ã¹ã¾ã—ãŸã€‚

ãªãŠã€ã“ã®è¨˜äº‹ã«æ›¸ã„ã¦ã„ã‚‹å†…å®¹ã¯ã“ã“ã«ã»ã¼åŒã˜ã“ã¨ãŒæ›¸ã„ã¦ã„ã¾ã™ã€‚

https://github.com/remix-run/remix/issues/9473#issuecomment-2127211524

## Error: No route matches URL "/foo"
```
Error: No route matches URL "/foo"
    at getInternalRouterError (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:4501:59)
    at Object.query (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:3331:19)
    at handleDocumentRequestRR (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:184:35)
    at requestHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:108:24)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async nodeHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:736:27)
    at async /home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:739:15
```
### è¡¨ç¤ºã•ã‚Œã‚‹åŸå› 
ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«remixãŒãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã§ã™ã€‚å®Ÿè£…ã¯ã“ã®ã‚ãŸã‚Šã§ã—ãŸã€‚

https://github.com/remix-run/remix/blob/8f38118e44298d609224c6074ae6519d385196f1/packages/remix-server-runtime/server.ts#L459-L467
https://github.com/remix-run/remix/blob/8f38118e44298d609224c6074ae6519d385196f1/packages/remix-server-runtime/server.ts#L69-L78

### è¡¨ç¤ºã•ã›ãªã„æ–¹æ³•
ã“ã®é–¢æ•°ã¯entry.server.tsxã§`handleError`ã¨ã„ã†é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã¨å‹•ä½œã‚’ä¸Šæ›¸ãã§ãã¾ã™ã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã¡ã‚‰ã€‚

https://remix.run/docs/en/main/file-conventions/entry.server#handleerror

ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§å®Ÿè£…ã™ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚

```ts
export function handleError(
  error: unknown,
  { request }: LoaderFunctionArgs | ActionFunctionArgs,
) {
  if (
    (isRouteErrorResponse(error) && error.status === 404) ||
    request.signal.aborted
  ) {
    return;
  }
  console.error(error);
}
```

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸­æ­¢ã•ã‚ŒãŸæ™‚ã¯ãƒ­ã‚°ã‚’å‡ºã•ãªã„æ–¹ãŒè‰¯ã„ã¨ã®ã“ã¨ãªã®ã§ã€`request.signal.aborted`ã‚‚è¦‹ã¦ã„ã¾ã™ã€‚

> Note that you generally want to avoid logging when the request was aborted, since Remix's cancellation and race-condition handling can cause a lot of requests to be aborted.
> https://remix.run/docs/en/main/file-conventions/entry.server#handleerror

## No routes matched location "/foo" 
```
No routes matched location "/foo" 
```
### è¡¨ç¤ºã•ã‚Œã‚‹åŸå› 
react-routerãŒä¸€è‡´ã—ãªã„ãƒ«ãƒ¼ãƒˆã«å¯¾ã—ã¦ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚å®Ÿè£…ã¯ã“ã‚Œã€‚

https://github.com/remix-run/react-router/blob/9afac15d8cbe30b37d0f9e8b89c9f1e430dfe35a/packages/react-router/lib/hooks.tsx#L450-L454

### è¡¨ç¤ºã•ã›ãªã„æ–¹æ³•
é–‹ç™ºç’°å¢ƒã§ã®ã¿å‡ºã‚‹ãƒ­ã‚°ã®ã‚ˆã†ãªã®ã§ã€æœ¬ç•ªç’°å¢ƒã§ã¯å‡ºã¾ã›ã‚“ã€‚è¨­å®šä¸è¦ã€‚

## ErrorResponseImpl
```
ErrorResponseImpl {
  status: 404,
  statusText: 'Not Found',
  internal: true,
  data: 'Error: No route matches URL "/foo"',
  error: Error: No route matches URL "/foo"
      at getInternalRouterError (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:4501:59)
      at Object.query (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+router@1.15.1/node_modules/@remix-run/router/dist/router.cjs.js:3331:19)
      at handleDocumentRequestRR (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:184:35)
      at requestHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+server-runtime@2.7.0_typescript@5.5.4/node_modules/@remix-run/server-runtime/dist/server.js:108:24)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async nodeHandler (/home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:736:27)
      at async /home/ubuntu/playground/remix-404-error/node_modules/.pnpm/@remix-run+dev@2.7.0_@remix-run+serve@2.7.0_typescript@5.5.4_vite@5.4.2/node_modules/@remix-run/dev/dist/vite/plugin.js:739:15
}
```
### è¡¨ç¤ºã•ã‚Œã‚‹åŸå› 
RemixãŒReactã§ã®ã‚¨ãƒ©ãƒ¼ã«å¯¾ã—ã¦ErrorBoundaryã‚’è¡¨ç¤ºã™ã‚‹æ™‚ã«ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã§ã™ã€‚å®Ÿè£…ã¯å¤šåˆ†ã“ã‚Œã§ã™ã€‚

https://github.com/remix-run/remix/blob/8f38118e44298d609224c6074ae6519d385196f1/packages/remix-react/errorBoundaries.tsx#L72-L79

### è¡¨ç¤ºã•ã›ãªã„æ–¹æ³•
`ErrorBoundary`ã¨ã„ã†åå‰ã§ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’exportã™ã‚‹ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒ™å‹•ã‚’ä¸Šæ›¸ãã§ãã¾ã™ã€‚[root.tsx](https://remix.run/docs/en/main/file-conventions/root)ãªã©ã«é©å½“ãªå†…å®¹ã§ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

https://remix.run/docs/en/main/route/error-boundary

## ã¾ã¨ã‚
- entry.server.tsxã«`handleError`ã‚’æ›¸ã
- root.tsxã«`ErrorBoundary`ã‚’æ›¸ã
- æœ¬ç•ªç’°å¢ƒã«ã™ã‚‹

ä»¥ä¸Šã§ãƒ­ã‚°ã‚’æŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚[Issueã¸ã®ãƒ¡ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ](https://github.com/remix-run/remix/issues/9473#issuecomment-2127211524)ã‚’è¦‹ã‚‹é™ã‚Šæ„å›³ã—ãŸæŒ™å‹•ã®ã‚ˆã†ã§ã™ãŒã€ã¡ã‚‡ã£ã¨åˆ†ã‹ã‚Šã«ãã„ã¨æ€ã„ã¾ã—ãŸã€‚

404ãƒšãƒ¼ã‚¸ã§ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒç…©ã‚ã—ããªã£ã¦ããŸæ™‚ã¯å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
