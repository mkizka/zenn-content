---
title: "ESLintã®Flat Configç§»è¡Œã§ã‚„ã£ã¦è‰¯ã‹ã£ãŸã“ã¨"
emoji: "ğŸ§¶"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["eslint", "typescript"]
published: true
---

ESLintã®v9.0.0ã§ã¯Flat Config(eslint.config.js)ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¾ã§ã®.eslintrcã®å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ä½¿ãˆã¾ã™ãŒã€`ESLINT_USE_FLAT_CONFIG`ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

https://eslint.org/blog/2024/04/eslint-v9.0.0-released/

ã“ã‚Œã‚’æ©Ÿã«Flat Configã§æ™®æ®µä½¿ã£ã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’æ•´ç†ã—ã¦æ›¸ã„ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ãã®éš›ã‚„ã£ã¦è‰¯ã‹ã£ãŸã“ã¨ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

ä½œæˆã—ãŸè¨­å®šã¯[Sharable Config](https://eslint.org/docs/latest/extend/shareable-configs)ã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/mkizka/eslint-config

## typescript-eslintã®tseslint.configã‚’ä½¿ã†

Flat configã¯ã“ã®ã‚ˆã†ã«é…åˆ—ã§æ›¸ãã¾ã™ã€‚

```js
export default [
  {
    rules: {
      "no-unused-vars": "error",
      "no-undef": "error"
    }
  }
];
```

ã“ã‚Œã§ã‚‚è‰¯ã„ã®ã§ã™ãŒå‹ãŒã‚ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚typescript-eslintã§ã¯`tseslint.config`ã¨ã„ã†ã“ã®é…åˆ—éƒ¨åˆ†ã«ç›¸å½“ã™ã‚‹å‹ã‚’æä¾›ã—ã¦ãã‚Œã‚‹é–¢æ•°ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

https://typescript-eslint.io/getting-started

```js
// @ts-check
import eslint from '@eslint/js';
import tseslint from 'typescript-eslint';

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommended,
  {
    rules: {
      //ã€€ã“ã“ã«ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™
    }
  }
);
```

### tseslint.configã¯extendsãŒä½¿ãˆã‚‹

`tseslint.config`ã¯å¼•æ•°ã«å¯¾ã—ã¦å‹ã‚’æä¾›ã—ãã®ã¾ã¾é…åˆ—ã«ã—ã¦è¿”ã™ã ã‘ã®é–¢æ•°ã§ã™ãŒã€ã•ã‚‰ã«`extends`ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½¿ç”¨ã§ãã¾ã™ã€‚

:::message
ã“ã®`extends`ã¯.eslintrcã«ç™»å ´ã™ã‚‹extendsã¨ã¯åˆ¥ã®ã‚‚ã®ã§ã™ã€‚
:::

ã“ã®`extends`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```js
export default tseslint.config({
  files: ['**/*.ts'],
  extends: [
    eslint.configs.recommended,
    ...tseslint.configs.recommended,
  ],
  rules: {
    '@typescript-eslint/array-type': 'error',
    '@typescript-eslint/consistent-type-imports': 'error',
  },
});
```

ã“ã‚Œã¯ä»¥ä¸‹ã¨åŒç­‰ã«ãªã‚Šã¾ã™ã€‚

```js
export default [
  {
    files: ['**/*.ts'],
    rules: {
      // eslint.configs.recommendedãŒæŒã£ã¦ã„ã‚‹ãŸãã•ã‚“ã®ãƒ«ãƒ¼ãƒ«
    }
  }
   {
    files: ['**/*.ts'],
    rules: {
      // tseslint.configs.recommendedãŒæŒã£ã¦ã„ã‚‹ãŸãã•ã‚“ã®ãƒ«ãƒ¼ãƒ«
    }
  }
  // ãã®ä»–ã®tseslint.configs.recommendedã®ãƒ«ãƒ¼ãƒ«(çœç•¥)
  {
    files: ['**/*.ts'],
    rules: {
      // æœ€å¾Œã«ã‚‚ã¨ã‚‚ã¨æŒ‡å®šã—ã¦ã„ãŸãƒ«ãƒ¼ãƒ«
      '@typescript-eslint/array-type': 'error',
      '@typescript-eslint/consistent-type-imports': 'error',
    },
  },
];
```

ã“ã®é–¢æ•°ã§ã¯`files`(ã¾ãŸã¯`ignores`)ã§æŒ‡å®šã—ãŸå€¤ã‚’ã€`extends`ã®å„ãƒ«ãƒ¼ãƒ«ã¨`extends`ä»¥å¤–ãã‚Œãã‚Œã«é©ç”¨ã—ã¦è¿”ã™ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚`extends`ã‚’æŒã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€æœ€çµ‚çš„ã«`exntends`ã®è¦ç´ æ•°+1å€‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚Šã¾ã™ã€‚

å®Ÿè£…ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã‚ˆã‚Šåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚ã“ã®ã‚ˆã†ãªçŸ­ã„é–¢æ•°ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://github.com/typescript-eslint/typescript-eslint/blob/679ed8efacd0cdecc3daab8f5dd0625c1075afb9/packages/typescript-eslint/src/config-helper.ts#L85-L107

ã“ã‚Œã«ã‚ˆã£ã¦eslintã‚„typescript-eslintã®è¤‡æ•°ã®è¨­å®šã«ã¾ã¨ã‚ã¦`files`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚å‰è¿°ã®ä¾‹ã®ã‚ˆã†ã«ã€ç‰¹å®šã®æ‹¡å¼µå­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã ã‘é©ç”¨ã—ãŸã„ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹æ™‚ã«ä¾¿åˆ©ã§ã™ã€‚

### @eslint/eslintrcã¨çµ„ã¿åˆã‚ã›ã‚‹

@eslint/eslintrcã®`FlatCompat`ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```js
[
   {
    extends: compat.extends("Flat Configã«å¯¾å¿œã—ã¦ã„ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒª")
    rules: {
      // â†‘ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ«ãƒ¼ãƒ«
    },
  }
]
```

ã“ã‚Œã¯â†“ã¨çµå±€åŒã˜çµæœã«ãªã‚Šã¾ã™ãŒã€1ã¤ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ãƒ«ãƒ¼ãƒ«ãŒ1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã¾ã£ã¦ã„ã¦è¦‹ã‚„ã™ã„ã§ã™(æ„Ÿæƒ³)ã€‚

```js
[
   ...compat.extends("Flat Configã«å¯¾å¿œã—ã¦ã„ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒª")
  {
    rules: {
      // â†‘ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ«ãƒ¼ãƒ«
    },
  }
]
```

## ä½œæˆã—ãŸãƒ«ãƒ¼ãƒ«ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒæ›¸ã‘ã‚‹

Flat Configç§»è¡Œå‰å¾Œã§ãƒ«ãƒ¼ãƒ«ã®å¤‰åŒ–ã‚’è¦‹ãŸã‚Šã€ãƒ«ãƒ¼ãƒ«ã‚’ç¶­æŒã—ãŸã¾ã¾è¨­å®šã®æ›¸ãæ–¹ã‚’å¤‰ãˆãŸã„å ´åˆã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒä¾¿åˆ©ã§ã™ã€‚

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã«ã¯`ESLint`ã¾ãŸã¯`FlatESLint`ã‚¯ãƒ©ã‚¹ã®`calculateConfigForFile`ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ç”¨ã§ãã¾ã™ã€‚

https://eslint.org/docs/latest/integrate/nodejs-api#-eslintcalculateconfigforfilefilepath

ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã§.jsãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®è¨­å®šã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

```js
import { ESLint } from "eslint";
test("index.js", async () => {
  const eslint = new ESLint();
  const result = await eslint.calculateConfigForFile("index.js");
  expect(result).toMatchSnapshot();
});
```

### ESLintãŒv8ã®å ´åˆ
ä¸Šè¨˜ã®ãƒ†ã‚¹ãƒˆã¯eslintã®9.0.0ã§å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

ESLintã®v8ã§ã¯.eslintrcã®å½¢å¼ã«ã¯`ESLint`ã‚¯ãƒ©ã‚¹ãŒã€Flat Configã«ã¯`FlatESLint`ã‚¯ãƒ©ã‚¹ãŒå¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

`FlatESLint`ã‚¯ãƒ©ã‚¹ã¯`eslint/use-at-your-own-risk`ã«å…¥ã£ã¦ã„ã¾ã™ã€‚è‡ªåˆ†ãŒè©¦ã—ãŸéš›ã¯å‹å®šç¾©ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€importã—ã¦ä½¿ç”¨ã§ãã¾ã—ãŸã€‚

```js
import { FlatESLint as ESLint } from "eslint/use-at-your-own-risk.js";
```

https://eslint.org/blog/2022/08/new-config-system-part-3/#using-flat-config-with-the-eslint-class

ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ESLintã‚¯ãƒ©ã‚¹ã§ä»¥å‰ã®è¨­å®šã‚’å‡ºåŠ›ã—ã€FlatESLintã‚¯ãƒ©ã‚¹ã§æ–°ã—ã„è¨­å®šã‚’å‡ºåŠ›ã—ã¦æ¯”è¼ƒã™ã‚‹ã¨ã„ã†ã“ã¨ã‚‚ã§ãã‚‹ã¯ãšã§ã™ã€‚

## ESLintãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯FlatCompatç„¡ã—ã§ä½¿ãˆã‚‹å ´åˆã‚‚ã‚ã‚‹

eslintã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ã„ãã¤ã‹ç¨®é¡ãŒã‚ã‚Šã€extendsã™ã‚‹ã“ã¨ãŒå‰æã«ãªã£ã¦ã„ã‚‹eslint-config-xxxç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Flat Configã«å¯¾å¿œã—ã¦ã„ãªã‘ã‚Œã°`FlatCompat`ã®`extends`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

eslint-plugin-xxxç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚`FlatCompat`ã®`plugins`ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆã¾ã™ãŒã€ãã®ã¾ã¾ã§ã‚‚æ„å¤–ã¨å‹•ãå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°[eslint-plugin-unused-imports](https://www.npmjs.com/package/eslint-plugin-unused-imports)ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¨å‹•ãã¾ã—ãŸã€‚


```js
import unusedImports from "eslint-plugin-unused-imports";
// çœç•¥
  {
    plugins: {
      "unused-imports": unusedImports,
    },
    rules: {
      "@typescript-eslint/no-unused-vars": "off",
      "unused-imports/no-unused-imports": "error",
    },
  },
```

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®exportsãŒFlat Configã¨ã—ã¦ã‚‚å•é¡Œãªã„å½¢ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã¨æ¨æ¸¬ã§ãã¾ã™ãŒã€ã¨ã¯ã„ãˆä»–ã«å•é¡ŒãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§è‰¯ã„æ–¹æ³•ã§ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚

https://github.com/sweepline/eslint-plugin-unused-imports/blob/ca1fe4734034b28b0854ee833865d60e219b8849/lib/index.js#L11-L16

ã‚ãã¾ã§å‹•ãã¾ã—ãŸã¨ã„ã†å…±æœ‰ã§ã™ã€‚

## @eslint/config-inspectorãŒä¾¿åˆ©

ã“ã‚Œã«ã¤ã„ã¦ã‚‚æ›¸ã“ã†ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€æ›¸ãå§‹ã‚ãŸå½“æ—¥ã¡ã‚‡ã†ã©å…¬å¼ã‹ã‚‰è¨˜äº‹ãŒå‡ºãŸã®ã§ãã®ã¾ã¾è¼‰ã›ã¦ãŠãã¾ã™ã€‚

https://eslint.org/blog/2024/04/eslint-config-inspector/

![](https://eslint.org/assets/images/blog/2024/config-inspector-intro.png)

è¨­å®šã—ãŸãƒ«ãƒ¼ãƒ«ãŒæœ€çµ‚çš„ã«ã©ã®ã‚ˆã†ã«ãªã£ãŸã‹ã‚’UIã§ç¢ºèªã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## ãŠã‚ã‚Š

ESLintã®è¨­å®šã‚’Flat Configã§æ›¸ã„ã¦ã¿ã¦ã‚„ã£ãŸã“ã¨ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚è‡ªåˆ†ç”¨ã®Sharable Configã‚’ä½œã‚‹ã®ãŠã™ã™ã‚ã§ã™ã€‚
