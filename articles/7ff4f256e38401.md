---
title: "自分のためのESLint設定をFlat configで作る"
emoji: "🧶"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["eslint", "typescript"]
published: false
---

ESLintのv9.0.0ではFlat config(eslint.config.js)がデフォルトになりました。これまでの.eslintrcの形式のファイルも使えますが、`ESLINT_USE_FLAT_CONFIG `環境変数を設定する必要があるようです。

https://eslint.org/blog/2024/04/eslint-v9.0.0-released/

これを機にFlat configを使ってみようと思い、さらに[Sharable Config](https://eslint.org/docs/latest/extend/shareable-configs)として公開したのでやったことをまとめます。

Flat configの書き方や移行方法はすでに他の記事や公式のマイグレーションガイドがあるので、Sharable Configとして必要だったことを中心に記載します。


## 作成したライブラリ

https://github.com/mkizka/eslint-config

## 使用したプラグイン

- [typescript-eslint](https://typescript-eslint.io/)
  - TypeScript用のルールセット
  - 以前は@typescript-eslint/eslint-pluginという名前でしたが、Flat configの場合はこちら
- [eslint-plugin-simple-import-sort](https://www.npmjs.com/package/eslint-plugin-simple-import-sort)
  - importの順番をいい感じに整理してくれるルール
- [eslint-plugin-unused-imports](https://www.npmjs.com/package/eslint-plugin-unused-imports)
  - 使っていないimport文を削除してくれるルール
- [eslint-plugin-eqeqeq-fix](https://www.npmjs.com/package/eslint-plugin-eqeqeq-fix)
  - `==`を`===`に自動修正してくれるルール
- [@dword-design/eslint-plugin-import-alias](https://www.npmjs.com/package/@dword-design/eslint-plugin-import-alias)
  - importのエイリアス(`@/...`)を使うように自動修正してくれるルール


## 1. typescript-eslintを使って基本的な設定を書く

Flat configはこのように配列で書きます。

```js
export default [
  {
    rules: {
      "no-unused-vars": "error",
      "no-undef": "error"
    }
  }
];
```

これでも良いのですが型があると便利です。typescript-eslintでは`tseslint.config`というこの配列部分に相当する型を提供してくれる関数を使用できます([ドキュメント](https://typescript-eslint.io/getting-started))。

```js
import eslint from '@eslint/js';
import tseslint from 'typescript-eslint';

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommended,
);
```

これをベースに設定を追加していくような書き方で進めていきました。

### tseslint.configとは

ここで登場する`tseslint.config`は基本的には受け取った引数を配列にして返すだけの関数ですが、さらに`extends`というプロパティが使用できます。

:::message
この`extends`は.eslintrcに登場するextendsとは別のものです。
:::

この`extends`は以下のように使用します。

```js
export default tseslint.config({
  files: ['**/*.ts'],
  extends: [
    eslint.configs.recommended,
    ...tseslint.configs.recommended,
  ],
  rules: {
    '@typescript-eslint/array-type': 'error',
    '@typescript-eslint/consistent-type-imports': 'error',
  },
});
```

これは以下と同等になります。

```js
export default [
  {
    files: ['**/*.ts'],
    rules: {
      // eslint.configs.recommendedが持っているたくさんのルール
    }
  }
   {
    files: ['**/*.ts'],
    rules: {
      // tseslint.configs.recommendedが持っているたくさんのルール
    }
  }
  // その他のtseslint.configs.recommendedのルール(省略)
  {
    files: ['**/*.ts'],
    rules: {
      // 最後にもともと指定していたルール
      '@typescript-eslint/array-type': 'error',
      '@typescript-eslint/consistent-type-imports': 'error',
    },
  },
];
```

文章で説明すると、`files`(または`ignores`)で指定した値を、`extends`の各ルールと`extends`以外それぞれに適用して返すというものです。返り値は`exntends`の数+1の要素数を持った配列になります。

実装を確認してみるとより分かりやすいです。このような短い関数になっています。

https://github.com/typescript-eslint/typescript-eslint/blob/679ed8efacd0cdecc3daab8f5dd0625c1075afb9/packages/typescript-eslint/src/config-helper.ts#L85-L107

## 2. ルールを追加していく

ベースの設定ができたのでここにルールを追加していきます。今回は使用したいライブラリがFlat configに対応しているかどうかでやり方を変えるだけでした。

最終的にはこのようになりました。こだわったところとしては、eslintの推奨設定、jsファイルのみを対象としたルール、tsファイルのみを対象としたルール、両方のファイルを対象としたルール、の順で書くことで配列の要素をグルーピングしていることです。

https://github.com/mkizka/eslint-config/blob/9d7d8190fce4ee3d0c762a4402da2db54da13c48/src/index.ts

## 3. Flat configに対応していないライブラリをpeerDependenciesに移動する

